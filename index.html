<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Per Te</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Verdana', sans-serif;
            font-style: italic;
            background-image: url('Images/wp_body.jpg');
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover; /* adatta a tutti gli schermi */
            display: flex;
            justify-content: center;
            width: 100%;
            min-height: 100vh;

            z-index: 0; /* contenuto sopra allo sfondo animato */
        }

        /* livello sopra per l'immagine nuova */
        /* body::after {
            content: "";
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            background-image: var(--nuovo-sfondo, none);
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: -1;
            pointer-events: none;
        }

        body::after {
            background-image: var(--nuovo-sfondo, none);
        } */

        body::before, body::after {
            content: "";
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: -1;
        }

        body::before {
            background-image: var(--before-bg);
        }
        body::after {
            background-image: var(--after-bg);
        }

        body.show-before::before {
            opacity: 1;
        }
        body.show-after::after {
            opacity: 1;
        }

        /* body.fade-sfondo::after {
            opacity: 1;
        }
  */
        /* Titoli */
        h1 {
            color: rgba(51, 46, 60, 1);
            font-size: clamp(1.5rem, 5vw, 3rem); /* da 24px a 48px */
            margin-bottom: 0.5em;
            text-shadow: 2px 2px rgba(51, 51, 51, 0.3);
            text-align: center;
        }

        /* Paragrafi */
        p {
            font-size: clamp(1rem, 4vw, 1.3rem);
            margin-bottom: 1.5em;
            color: rgba(0,0,0,0.75);
        }

        /* Contenitore generale */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 90%;
            max-width: 90%; /* non si allarga troppo su desktop */
            min-height: 25vh;
            perspective: 1000px;
            max-height: 35vh;
            height: fit-content;
        }

        /* Frasi effetto libro */
        .frase {
            font-size: clamp(1rem, 4vw, 1.4rem);
            color: #333;
            opacity: 0;
            transform: rotateY(90deg);
            transform-origin: left center;
            transition: opacity 0.6s, transform 0.8s ease;
            width: 100%;
            backface-visibility: hidden;
            position: absolute;
            top: 20%;
            text-align: center;
            padding: 1em;
        }

        .frase.attiva {
            opacity: 1;
            transform: rotateY(0deg);
        }

        .frase.uscente {
            opacity: 0;
            transform: rotateY(-90deg);
        }


        /* Bottoni */
        button {
            font-family: 'Verdana', sans-serif;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 5px 3px 6px rgba(51, 51, 51, 0.3);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .button {
            background-color: rgba(44, 62, 80, 0.45);
            color: white;
            padding: 0.6em 1.5em;
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            position: relative;
            margin-top: 1em;
        }
        .button:hover {
            background-color: rgba(44, 62, 80, 0.6);
            box-shadow: 5px 3px 7px rgba(51, 51, 51, 0.8);
        }

        .buttonIntro {
            background-color: rgba(44, 62, 80, 0.45);
            color: white;
            padding: 0.7em 1.5em;
            font-size: clamp(1rem, 4vw, 1.2rem);
            margin-top: 5%;
        }
        .buttonIntro:hover {
            background-color: rgba(44, 62, 80, 0.6);
            box-shadow: 5px 3px 7px rgba(51, 51, 51, 0.8);
        }

        /* Intro box */
        .intro {
            position: relative;
            box-shadow: 10px 10px 15px rgba(0,0,0,0.25);
            border-radius: 20px;
            border: 1px solid rgba(51, 51, 51, 0.3);
            background-color: rgba(51, 51, 51, 0.1);
            backdrop-filter: blur(3px);
            padding: 1.5em;
            max-width: 70%;
            max-height: 35vh;
            text-align: center;
            height: fit-content;
            margin-top: 4vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Carosello box */
        .carosello {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 70%;
            max-height: 35vh;
            height: fit-content;
            box-shadow: 10px 10px 15px rgba(0,0,0,0.25);
            border-radius: 20px;
            border: 1px solid rgba(51, 51, 51, 0.3);
            background-color: rgba(51, 51, 51, 0.1);
            backdrop-filter: blur(3px);
            padding: 1em;
            margin-top: 4vh;
            width: 60%;
        }

        /* Utility */
        .hidden {
            display: none;
        }

        /* MEDIA QUERY AGGIUNTIVE */
        @media (max-width: 600px) {
            body {
                background-image: url('Images/main_mobile_wp.jpeg');
            }
            .intro, .carosello {
                padding: 1em;
            }
            .button, .buttonIntro {
                width: 100%;
                font-size: 1em;
            }
        }

    </style>
  </head>
  <body>
    <div class="intro" id="intro">
        <h1>Stavo pensando...</h1>
        
        <p class="messaggio attivo">
            Placeholder messaggio molto lungo per test streach <br>
            Testo a capo per provare l'altezza <br>
            test a capo 2
            <br>
            test 3
            <br>
            test 4
        </p>
        <p class="messaggio hidden">
            Placeholder
        </p>
        
        <button onclick="cambioMessaggio()" class="buttonIntro">Continua</button>
    </div>
     
    <div id="domanda1" class="hidden">
        <div class="container" id="contenitoreFrasi">
            <div class="frase attiva">
                "Frase 1"
            </div>
            <div class="frase hidden">
                "Frase 2"
            </div>
            <div class="frase hidden">
                "Frase 3"
            </div>
            <div class="frase hidden">
                "Frase 4"
            </div>
            <div class="frase hidden">
                <!-- "Frase 5" üíñ -->
                "Frase 5"
            </div>
        </div>

        <button class="button" onclick="prossimaFrase()">Avanti ‚û°Ô∏è</button>
    </div>

    <script>
        function cambioMessaggio(){
            const messaggi = document.querySelectorAll('.messaggio');
            let indiceMessaggi = 0;
            
            // Nascondi frase attuale
            messaggi[indiceMessaggi].classList.remove('attivo');
            messaggi[indiceMessaggi].classList.add('hidden');

            // Avanza di uno
            indiceMessaggi++;

            // Mostra la nuova frase (se esiste)
            if (indiceMessaggi < messaggi.length) {
                messaggi[indiceMessaggi].classList.add('attivo');
                messaggi[indiceMessaggi].classList.remove('hidden');
                
                // Se √® l'ultima frase, cambia gi√† il testo del bottone
                if (indiceMessaggi === messaggi.length - 1) {
                    const bottone = document.querySelector('.buttonIntro');
                    bottone.onclick = mostraCarosello;
                    return;
                }

            }
        }

        function mostraCarosello() {
            document.getElementById("intro").classList.add("hidden");
            document.getElementById("domanda1").classList.remove("hidden");
            document.getElementById("domanda1").classList.add("carosello");
            
            cambiaSfondo('Images/carosello_mobile.jpeg');
        }

        
        let indice = 0;
        function prossimaFrase() {
            const frasi = document.querySelectorAll('.frase');
            const fraseCorrente = frasi[indice];

            // Nascondi frase attuale
            fraseCorrente.classList.remove('attiva');
            fraseCorrente.classList.add('uscente');

            // dopo la durata della transizione (0.8s) nasconde la frase
            setTimeout(() => {
                fraseCorrente.classList.add('hidden');
                fraseCorrente.classList.remove('uscente');
            }, 800);

            // Avanza di uno
            indice++;

            // Mostra la nuova frase (se esiste)
            if (indice < frasi.length) {
                const nuovaFrase = frasi[indice];

                nuovaFrase.classList.remove('hidden');
                nuovaFrase.classList.add('attiva');

                // Se √® l'ultima frase, cambia gi√† il testo del bottone
                if (indice === frasi.length - 1) {
                    const bottone = document.querySelector('.button');
                    bottone.innerText = "Fine üíñ";
                    bottone.disabled = true;
                    return;
                }

            }
        }

        // function cambiaSfondo(nuovaImmagine) {
        //     const body = document.body;
        //     const durata = 1000; // ms, stessa del CSS

        //     // imposta la nuova immagine come overlay
        //     body.style.setProperty('--nuovo-sfondo', `url(${nuovaImmagine})`);
        //     body.classList.add("fade-sfondo");
        //     body.style.setProperty("--nuovo-sfondo", `url(${nuovaImmagine})`);

        //     // forza l'immagine sull'overlay
        //     body.querySelector("style#sfondo-dinamico")?.remove();
        //     const style = document.createElement("style");
        //     style.id = "sfondo-dinamico";
        //     style.innerHTML = `body::after { background-image: url(${nuovaImmagine}); }`;
        //     document.head.appendChild(style);

        //     // dopo il fade-in, sostituiamo l'immagine di sfondo del body
        //     setTimeout(() => {
        //         body.style.backgroundImage = `url(${nuovaImmagine})`;
        //         // togliamo subito la classe per fermare qui l'animazione
        //         body.classList.remove("fade-sfondo");
        //     }, durata);
        // }

        // function cambiaSfondo(nuovaImmagine) {
        //     const body = document.body;
        //     const durata = 1000; // ms, stessa del CSS

        //     // Imposta la nuova immagine nell'overlay
        //     const style = document.createElement("style");
        //     style.id = "sfondo-dinamico";
        //     style.innerHTML = `body::after { background-image: url(${nuovaImmagine}); }`;
        //     document.getElementById("sfondo-dinamico")?.remove();
        //     document.head.appendChild(style);

        //     // Avvia il fade-in
        //     body.classList.add("fade-sfondo");

        //     // Dopo la durata:
        //     setTimeout(() => {
        //         // assegna lo sfondo direttamente al body
        //         body.style.backgroundImage = `url(${nuovaImmagine})`;

        //         // rimuovi la classe e lo style per evitare un secondo fade
        //         body.classList.remove("fade-sfondo");
        //         document.getElementById("sfondo-dinamico")?.remove();
        //     }, durata);
        // }

        let currentLayer = 'before';

        function cambiaSfondo(nuovaImmagine) {
            const body = document.body;
            const nextLayer = currentLayer === 'before' ? 'after' : 'before';

            // aggiorna lo sfondo del prossimo layer
            body.style.setProperty(`--${nextLayer}-bg`, `url(${nuovaImmagine})`);

            // imposta opacit√†
            body.classList.add(`show-${nextLayer}`);
            body.classList.remove(`show-${currentLayer}`);

            // aggiorna il riferimento
            currentLayer = nextLayer;
        }

    </script>
  </body>
</html>
